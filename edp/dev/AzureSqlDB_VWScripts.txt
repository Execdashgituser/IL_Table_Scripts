/****** Object:  View [dbo].[VW_EDP_CATALOG]    Script Date: 11/6/2020 11:57:08 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE  VIEW [dbo].[VW_EDP_CATALOG] AS
SELECT PC1.PROJECT_ID AS PROJECT_ID,
       PC1.PROJECT_TITLE AS PROJECT_TITLE,
       AGG.PROGRAM_ID AS PROGRAM_ID,
       AGG.PROGRAM_NAME AS PROGRAM_NAME,
       AGG.PORTFOLIO_ID AS PORTFOLIO_ID,
       AGG.PORTFOLIO_NAME AS PORTFOLIO_NAME,
       PC1.INTAKE_SUMMARY AS INTAKE_SUMMARY,
       PC1.PROJECT_ADVANTAGE AS PROJECT_ADVANTAGE,
       PC1.TITLE_ABBREVIATION AS TITLE_ABBREVIATION,
       PC1.PROJECT_TYPE AS PROJECT_TYPE,
       PC1.PURPOSE_STATEMENT AS PURPOSE_STATEMENT,
       PC1.PROJECT_SIZE AS PROJECT_SIZE,
       PC1.PROJECT_STATUS_NUM AS PROJECT_STATUS_NUM,
       PC1.PROJECT_STATUS AS PROJECT_STATUS,
       PC1.DEPARTMENT AS DEPARTMENT,
       PC1.DIVISION AS DIVISION,
       PC1.SPONSOR AS SPONSOR,
       PC1.PMO AS PMO,
       PC1.PMO_DIRECTOR AS PMO_DIRECTOR,
       PC1.PROJECT_MANAGER AS PROJECT_MANAGER,
       PC1.PRIMARY_VENDOR AS PRIMARY_VENDOR,
       PC1.IV_AND_V_VENDOR AS IV_AND_V_VENDOR,
       PC1.FEDERAL_FUNDING_PARTNER AS FEDERAL_FUNDING_PARTNER,
       PC1.STAGE_GATE AS STAGE_GATE,
       PC1.START_DATE AS START_DATE,
       PC1.DEADLINE_DATE AS DEADLINE_DATE,
       PC1.AGENCY_PRIORITY AS AGENCY_PRIORITY,
       PC1.DIVISION_PRIORITY AS DIVISION_PRIORITY,
       PC1.DEPENDENCY_ON_PRIMARY_PROJECT AS DEPENDENCY_ON_PRIMARY_PROJECT,
       PC1.FUND_TYPE AS FUND_TYPE,
       PC1.FUND_SPLIT AS FUND_SPLIT,
       PC1.EST_BUDGET AS EST_BUDGET,
       PC1.EST_BUDGET_SPENT AS EST_BUDGET_SPENT,
       PC1.EST_BUS_RSCS AS EST_BUS_RSCS,
       PC1.EST_TECH_RSCS AS EST_TECH_RSCS,
       PC1.EST_VEN_RSCS AS EST_VEN_RSCS,
       PC1.TOTAL_RSCS AS TOTAL_RSCS,
       PC1.SUPPORT_STAGE_STRATEGIC_GOAL AS SUPPORT_STAGE_STRATEGIC_GOAL,
       PC1.SUPPORT_AGENCY_STRATEGIC_GOAL AS SUPPORT_AGENCY_STRATEGIC_GOAL,
       PC1.SUPPORT_DIVISION_STRATEGIC_GOAL AS SUPPORT_DIVISION_STRATEGIC_GOAL,
       PC1.PRIMARY_BUSINESS_BENEFIT AS PRIMARY_BUSINESS_BENEFIT,
       PC1.INVESTMENT_TRANSFORMATION_BENEFIT AS INVESTMENT_TRANSFORMATION_BENEFIT,
       PC1.QUANTITATIVE_BENEFIT AS QUANTITATIVE_BENEFIT,
       PC1.QUALITATIVE_BENEFIT AS QUALITATIVE_BENEFIT,
       PC1.BENEFIT_OWNER AS BENEFIT_OWNER,
       PC1.COMPLEXITY AS COMPLEXITY,
       PC1.BENEFIT AS BENEFIT,
       PC1.MANDATORY_OVERRIDE AS MANDATORY_OVERRIDE,
       PC1.SCHEDULE AS SCHEDULE,
       PC1.SCOPE AS SCOPE,
       PC1.FINANCE AS FINANCE,
       PC1.HUMAN_RESOURCES AS HUMAN_RESOURCES,
       PC1.CONTRACT AS CONTRACT,
       PC1.IV_AND_V AS IV_AND_V,
       PC1.SPONSOR_TITLE AS SPONSOR_TITLE,
       PC1.ID_OF_STAFF AS ID_OF_STAFF,
       PC1.FTE AS FTE,
       PC1.PERCENTAGE_COMPLETE AS PERCENTAGE_COMPLETE,
       PC1.PERCENTAGE_SPENT AS PERCENTAGE_SPENT,
       PC1.APD_NUMBER AS APD_NUMBER,
       PC1.DURATION AS DURATION,
       PC1.DURATION_SPENT AS DURATION_SPENT,
       PC1.PERCENTAGE_TIME_SPENT AS PERCENTAGE_TIME_SPENT,
       PC1.PR_START_IN_NEXT_6MON AS PR_START_IN_NEXT_6MON,
       PC1.PR_END_IN_NEXT_6MON AS PR_END_IN_NEXT_6MON,
       PC1.STATUS_GATE AS STATUS_GATE,
       PC1.STATUS_SUMMARY AS STATUS_SUMMARY,
       AGG.RISK_COUNT AS RISK_COUNT,
       AGG.ISSUE_COUNT AS ISSUE_COUNT,
       AGG.ACTIVITY_COUNT AS ACTIVITY_COUNT
FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PC1
      JOIN
        ( SELECT PC.PROJECT_ID AS PROJECT_ID,
                PD.PROGRAM_ID AS PROGRAM_ID,
                PD.PROGRAM_NAME AS PROGRAM_NAME,
                PD.PORTFOLIO_ID AS PORTFOLIO_ID,
                PD.PORTFOLIO_NAME AS PORTFOLIO_NAME,
                count(DISTINCT RD.RISK_ID) AS RISK_COUNT,
                count(DISTINCT ID.ISSUE_ID) AS ISSUE_COUNT,
                count(DISTINCT AD.ACTIVITY_ID) AS ACTIVITY_COUNT
         FROM ((((EDP_DB.dbo.PROJECT_CATALOG_FACT PC
                  JOIN EDP_DB.dbo.PROJECT_DIMENSION PD on((PC.PROJECT_ID = PD.PROJECT_ID)))
                 LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((PC.PROJECT_ID = RD.PROJECT_ID)))
                LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((PC.PROJECT_ID = ID.PROJECT_ID)))
               LEFT JOIN EDP_DB.dbo.ACTIVITY_DIMENSION AD on((PC.PROJECT_ID = AD.PROJECT_ID)))
         --GROUP BY PD.PROJECT_ID,PC.PROJECT_ID
		 GROUP BY PC.PROJECT_ID ,
                PD.PROGRAM_ID ,
                PD.PROGRAM_NAME ,
                PD.PORTFOLIO_ID ,
                PD.PORTFOLIO_NAME ) AGG on((PC1.PROJECT_ID = AGG.PROJECT_ID)));


		
GO

/****** Object:  View [dbo].[VW_ISSUES_PG]    Script Date: 11/6/2020 11:57:21 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


CREATE  VIEW [dbo].[VW_ISSUES_PG] AS
SELECT AA.PROJECT_ID AS PROJECT_ID,
       AA.PROJECT_TITLE AS PROJECT_TITLE,
       AA.PROGRAM_ID AS PROGRAM_ID,
       AA.PROGRAM_NAME AS PROGRAM_NAME,
       AA.CRITICALITY AS CRITICALITY,
       sum(AA.ISSUECOUNT) AS ISSUECOUNT
FROM
  (SELECT PR.PROJECT_ID AS PROJECT_ID,
          PR.PROJECT_TITLE AS PROJECT_TITLE,
          PRD.PROGRAM_ID AS PROGRAM_ID,
          PRD.PROGRAM_NAME AS PROGRAM_NAME,
          '5' AS CRITICALITY,
          (CASE
               WHEN (ID.CRITICALITY_NUM = 5) THEN 1
               ELSE 0
           END) AS ISSUECOUNT
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((ID.PROJECT_ID = PRD.PROJECT_ID))) on((ID.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '4' AS CRITICALITY,
                    (CASE
                         WHEN (ID.CRITICALITY_NUM = 4) THEN 1
                         ELSE 0
                     END) AS ISSUECOUNT
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((ID.PROJECT_ID = PRD.PROJECT_ID))) on((ID.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '3' AS CRITICALITY,
                    (CASE
                         WHEN (ID.CRITICALITY_NUM = 3) THEN 1
                         ELSE 0
                     END) AS ISSUECOUNT
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((ID.PROJECT_ID = PRD.PROJECT_ID))) on((ID.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '2' AS CRITICALITY,
                    (CASE
                         WHEN (ID.CRITICALITY_NUM = 2) THEN 1
                         ELSE 0
                     END) AS ISSUECOUNT
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((ID.PROJECT_ID = PRD.PROJECT_ID))) on((ID.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '1' AS CRITICALITY,
                    (CASE
                         WHEN (ID.CRITICALITY_NUM = 1) THEN 1
                         ELSE 0
                     END) AS ISSUECOUNT
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.ISSUES_DIMENSION ID on((ID.PROJECT_ID = PRD.PROJECT_ID))) on((ID.PROJECT_ID = PR.PROJECT_ID)))) AA
GROUP BY AA.PROJECT_ID,
         AA.PROJECT_TITLE,
         AA.PROGRAM_ID,
         AA.PROGRAM_NAME,
         AA.CRITICALITY
--ORDER BY AA.PROJECT_ID,         AA.PROJECT_TITLE DESC
;
GO

/****** Object:  View [dbo].[VW_PROG_SUMMARY]    Script Date: 11/6/2020 11:57:31 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE  VIEW [dbo].[VW_PROG_SUMMARY] AS
SELECT VW_EDP_CATALOG.PROGRAM_NAME AS PROGRAM_NAME,
       min(VW_EDP_CATALOG.START_DATE) AS MIN_START_DATE,
       max(VW_EDP_CATALOG.DEADLINE_DATE) AS MAX_DEADLINE_DATE,
       avg(VW_EDP_CATALOG.DURATION) AS AVG_DURATION,
       avg(VW_EDP_CATALOG.PERCENTAGE_COMPLETE) AS AVG_PERCENT_DONE,
       avg(VW_EDP_CATALOG.PERCENTAGE_SPENT) AS AVG_PERCENT_SPENT,
       sum(VW_EDP_CATALOG.ID_OF_STAFF) AS STAFF_COUNT,
       sum(VW_EDP_CATALOG.RISK_COUNT) AS RISK_COUNT,
       sum(VW_EDP_CATALOG.ISSUE_COUNT) AS ISSUE_COUNT,
       count(VW_EDP_CATALOG.PROJECT_ID) AS PROJECT_COUNT
FROM EDP_DB.dbo.VW_EDP_CATALOG
GROUP BY VW_EDP_CATALOG.PROGRAM_NAME;
GO

/****** Object:  View [dbo].[VW_RISK_PG]    Script Date: 11/6/2020 11:57:41 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE  VIEW [dbo].[VW_RISK_PG] AS

SELECT AA.PROJECT_ID AS PROJECT_ID,
       AA.PROJECT_TITLE AS PROJECT_TITLE,
       AA.PROGRAM_ID AS PROGRAM_ID,
       AA.PROGRAM_NAME AS PROGRAM_NAME,
       AA.SEVERITY AS SEVERITY,
       sum(AA.riskcount) AS RISKCOUNT
FROM
  (SELECT PR.PROJECT_ID AS PROJECT_ID,
          PR.PROJECT_TITLE AS PROJECT_TITLE,
          PRD.PROGRAM_ID AS PROGRAM_ID,
          PRD.PROGRAM_NAME AS PROGRAM_NAME,
          '5' AS SEVERITY,
          (CASE
               WHEN (RD.CALCULATED_SEVERITY BETWEEN 21 AND 25) THEN 1
               ELSE 0
           END) AS riskcount
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((RD.PROJECT_ID = PRD.PROJECT_ID))) on((RD.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '4' AS SEVERITY,
                    (CASE
                         WHEN (RD.CALCULATED_SEVERITY BETWEEN 16 AND 20) THEN 1
                         ELSE 0
                     END) AS riskcount
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((RD.PROJECT_ID = PRD.PROJECT_ID))) on((RD.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '3' AS SEVERITY,
                    (CASE
                         WHEN (RD.CALCULATED_SEVERITY BETWEEN 11 AND 15) THEN 1
                         ELSE 0
                     END) AS riskcount
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((RD.PROJECT_ID = PRD.PROJECT_ID))) on((RD.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '2' AS SEVERITY,
                    (CASE
                         WHEN (RD.CALCULATED_SEVERITY BETWEEN 6 AND 10) THEN 1
                         ELSE 0
                     END) AS riskcount
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((RD.PROJECT_ID = PRD.PROJECT_ID))) on((RD.PROJECT_ID = PR.PROJECT_ID)))
   UNION ALL SELECT PR.PROJECT_ID AS PROJECT_ID,
                    PR.PROJECT_TITLE AS PROJECT_TITLE,
                    PRD.PROGRAM_ID AS PROGRAM_ID,
                    PRD.PROGRAM_NAME AS PROGRAM_NAME,
                    '1' AS SEVERITY,
                    (CASE
                         WHEN (RD.CALCULATED_SEVERITY BETWEEN 1 AND 5) THEN 1
                         ELSE 0
                     END) AS riskcount
   FROM (EDP_DB.dbo.PROJECT_CATALOG_FACT PR
         LEFT JOIN (EDP_DB.dbo.PROJECT_DIMENSION PRD
                    LEFT JOIN EDP_DB.dbo.RISKS_DIMENSION RD on((RD.PROJECT_ID = PRD.PROJECT_ID))) on((RD.PROJECT_ID = PR.PROJECT_ID)))) AA
GROUP BY AA.PROJECT_ID,
         AA.PROJECT_TITLE,
         AA.PROGRAM_ID,
         AA.PROGRAM_NAME,
         AA.SEVERITY
--ORDER BY AA.PROJECT_ID,AA.PROJECT_TITLE DESC
		 
GO

